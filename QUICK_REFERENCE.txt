================================================================
QUICK REFERENCE - AUTO-SAVE JAWABAN MODE UJIAN
================================================================

PERUBAHAN DIRINGKAS:
====================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. DATABASE - TABEL BARU: draft_attempts                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Kolom               â”‚ Tipe      â”‚ Keterangan                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                  â”‚ INT       â”‚ Primary Key                 â”‚
â”‚ session_id          â”‚ INT FK    â”‚ Referensi quiz_sessions     â”‚
â”‚ user_id             â”‚ INT FK    â”‚ Referensi users             â”‚
â”‚ question_id         â”‚ INT FK    â”‚ Referensi questions         â”‚
â”‚ choice_id           â”‚ INT       â”‚ ID pilihan jawaban          â”‚
â”‚ is_correct          â”‚ TINYINT   â”‚ 1=benar, 0=salah            â”‚
â”‚ status              â”‚ ENUM      â”‚ 'draft' atau 'submitted'    â”‚
â”‚ saved_at            â”‚ DATETIME  â”‚ Waktu disimpan              â”‚
â”‚ updated_at          â”‚ DATETIME  â”‚ Waktu terakhir diubah       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UNIQUE KEY: (session_id, question_id) â†’ 1 jawaban per soal

JALANKAN SCRIPT: create_draft_attempts_table.sql
================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. API ENDPOINT BARU: api_save_draft_answer()               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Endpoint      â”‚ ?action=api_save_draft_answer                â”‚
â”‚ Method        â”‚ POST                                         â”‚
â”‚ Content-Type  â”‚ application/json                             â”‚
â”‚ Purpose       â”‚ Auto-save jawaban ke draft_attempts          â”‚
â”‚ Triggered by  â”‚ handleAnswerClickExamMode()                 â”‚
â”‚ Behavior      â”‚ Async (fire & forget)                       â”‚
â”‚ Response      â”‚ JSON {ok: true/false, message, question_id} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LOKASI: index.php, line ~1801
================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. JAVASCRIPT MODIFICATION                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Function      â”‚ handleAnswerClickExamMode()                  â”‚
â”‚ Added at      â”‚ After saving to quizState.userAnswers        â”‚
â”‚ What it does  â”‚ Sends answer to api_save_draft_answer        â”‚
â”‚ Timing        â”‚ Before auto-advance to next question         â”‚
â”‚ Impact        â”‚ Answer saved to DB immediately               â”‚
â”‚ Error handle  â”‚ Silently catches errors                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LOKASI: index.php, line ~7050
================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. MONITORING LOGIC - 3 STATUS LEVELS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status          â”‚ Badge â”‚ Artinya                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Sudah Submit â”‚ Hijau  â”‚ Final submission done               â”‚
â”‚ ğŸŸ¡ Mengerjakan â”‚ Biru   â”‚ Draft answers saved (in progress)   â”‚
â”‚ â³ Belum Submit â”‚ Kuning â”‚ No action taken yet                 â”‚
â”‚ âŒ Terlambat    â”‚ Merah  â”‚ Past deadline                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LOKASI: view_monitor_jawaban(), line ~10750
================================================================

WORKFLOW TIMELINE:
==================

STEP 1: SISWA JAWAB SOAL
  â”‚
  â”œâ”€â†’ handleAnswerClickExamMode(selected)
  â”‚   â”œâ”€ Save to quizState.userAnswers (memory)
  â”‚   â”œâ”€ api_save_draft_answer() â† AUTO-SAVE KE DB
  â”‚   â”‚   â””â”€ INSERT/UPDATE draft_attempts (status='draft')
  â”‚   â”œâ”€ updateExamProgress()
  â”‚   â””â”€ setTimeout â†’ renderQuestion() atau confirmFinish()
  â”‚
  â””â”€â†’ MONITOR DETEKSI: Status = "ğŸŸ¡ Sedang Mengerjakan"

STEP 2: SISWA SUBMIT UJIAN
  â”‚
  â”œâ”€â†’ finishQuiz()
  â”‚   â””â”€ fetch api_submit_answers dengan semua jawaban
  â”‚
  â”œâ”€â†’ Backend api_submit_answers():
  â”‚   â”œâ”€ UPDATE draft_attempts SET status='submitted'
  â”‚   â”œâ”€ DELETE old attempts
  â”‚   â”œâ”€ INSERT attempts (final)
  â”‚   â”œâ”€ INSERT results (score)
  â”‚   â””â”€ INSERT assignment_submissions
  â”‚
  â””â”€â†’ MONITOR DETEKSI: Status = "âœ… Sudah Submit"

================================================================

DATA SOURCES UNTUK MONITOR:
============================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status               â”‚ Data dari           â”‚ Kolom             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Sudah Submit      â”‚ attempts            â”‚ question_id, etc  â”‚
â”‚                      â”‚ results             â”‚ score             â”‚
â”‚                      â”‚ assignment_sub.     â”‚ submitted_at      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ Sedang Mengerjakanâ”‚ draft_attempts      â”‚ saved_at          â”‚
â”‚                      â”‚ (status='draft')    â”‚ updated_at        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â³ Belum Submit      â”‚ class_members       â”‚ (tidak ada aksi)   â”‚
â”‚                      â”‚ (INNER JOIN only)   â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================

QUERY STRUCTURE (SIMPLIFIED):
==============================

SELECT ...
FROM class_members cm
INNER JOIN users u ON cm.id_pelajar = u.id
INNER JOIN assignments a ON a.id_kelas = cm.id_kelas
LEFT JOIN assignment_submissions asub ON ...
LEFT JOIN results r ON ...
LEFT JOIN attempts att ON ...
LEFT JOIN draft_attempts draft ON ... â† BARU
WHERE a.mode = 'ujian'
GROUP BY cm.id_pelajar, a.id, u.id
ORDER BY ...

STATUS LOGIC:
CASE 
  WHEN asub.id IS NOT NULL THEN 'Sudah Submit'
  WHEN COUNT(draft.id) > 0 THEN 'Sedang Mengerjakan' â† BARU
  ELSE 'Belum Submit'
END

================================================================

STATISTICS DASHBOARD (CARDS):
==============================

SEBELUM:
  âœ… Sudah Submit    â”‚ â³ Belum Submit    â”‚ ğŸ“ Total Siswa    â”‚ ğŸ“ˆ Rata-rata

SESUDAH:
  âœ… Sudah Submit    â”‚ ğŸŸ¡ Sedang Mengerjakan â”‚ â³ Belum Submit â”‚ ğŸ“ˆ Rata-rata
  (hanya for 'submitted') (NEW - for 'draft') (NEW)

================================================================

FILES MODIFIED:
================

1. index.php
   â”œâ”€ Line ~930   : Tambah routing untuk ?action=api_save_draft_answer
   â”œâ”€ Line ~1801  : Tambah fungsi api_save_draft_answer()
   â”œâ”€ Line ~1880  : Update api_submit_answers() (mark draft as submitted)
   â”œâ”€ Line ~7050  : Update handleAnswerClickExamMode() (auto-save)
   â””â”€ Line ~10750 : Update view_monitor_jawaban() (new status logic)

2. create_draft_attempts_table.sql (NEW)
   â””â”€ Script untuk membuat tabel draft_attempts

3. IMPLEMENTATION_AUTO_SAVE_JAWABAN.md (NEW)
   â””â”€ Dokumentasi lengkap

4. QUICK_REFERENCE.txt (ini)
   â””â”€ Ringkasan perubahan

================================================================

TESTING COMMAND:
=================

DATABASE:
---------
-- Cek tabel terbuat
SHOW TABLES LIKE 'draft_attempts';
DESCRIBE draft_attempts;

-- Cek sampel data (saat ujian berlangsung)
SELECT * FROM draft_attempts WHERE status='draft' ORDER BY updated_at DESC LIMIT 10;

-- Cek after submit
SELECT * FROM draft_attempts WHERE status='submitted' ORDER BY updated_at DESC LIMIT 10;

-- Cek jumlah by status
SELECT status, COUNT(*) as count FROM draft_attempts GROUP BY status;

BROWSER:
--------
1. Buka mode ujian
2. Jawab beberapa soal
3. Buka Dev Tools (F12)
4. Lihat tab "Network" â†’ setiap klik jawaban harus ada POST ke api_save_draft_answer
5. Buka database â†’ draft_attempts harus terisi
6. Refresh halaman monitor â†’ status siswa = "ğŸŸ¡ Sedang Mengerjakan"
7. Lanjut jawab soal (refresh tadi tidak reset jawaban krn di-save DB)
8. Klik "Selesaikan Ujian"
9. Refresh halaman monitor â†’ status siswa = "âœ… Sudah Submit"

================================================================

TROUBLESHOOTING:
=================

MASALAH: api_save_draft_answer call error 404
SOLUSI: Pastikan routing sudah ditambah di line ~930

MASALAH: Tabel draft_attempts tidak ketemu
SOLUSI: Jalankan SQL script create_draft_attempts_table.sql

MASALAH: Status monitor tidak berubah
SOLUSI: Cek apakah draft_attempts punya data (query database)

MASALAH: Query terlalu lambat
SOLUSI: Pastikan semua indexes sudah dibuat (lihat SQL script)

MASALAH: Data lama tidak cleared
SOLUSI: Opsional cleanup query ada di dokumentasi (delete old draft)

================================================================

ROLLBACK (JIKA BUTUH KEMBALIKAN):
===================================

1. Hapus tabel (jika mau reset total):
   DROP TABLE draft_attempts;

2. Revert index.php ke versi lama (backup di git)

3. Jika ingin keep data tapi stop auto-save:
   - Comment baris fetch di handleAnswerClickExamMode()
   - Data lama tetap di draft_attempts untuk audit trail

================================================================

DEPLOYMENT CHECKLIST:
=======================

PRE-DEPLOYMENT:
  â˜ Backup database
  â˜ Backup index.php
  â˜ Test di development environment

DEPLOYMENT:
  â˜ Jalankan create_draft_attempts_table.sql
  â˜ Upload index.php yang sudah dimodifikasi
  â˜ Clear browser cache (Ctrl+Shift+Del)

POST-DEPLOYMENT:
  â˜ Test siswa jawab soal â†’ check draft_attempts
  â˜ Test siswa ubah jawaban â†’ check UPDATE di draft_attempts
  â˜ Test siswa submit â†’ check status='submitted'
  â˜ Test monitor page â†’ check 3 status level
  â˜ Monitor error log untuk anomali

================================================================

PERFORMANCE IMPACT:
====================

POSITIF:
  âœ“ Real-time monitoring
  âœ“ Automatic backup jawaban
  âœ“ Can track student progress
  âœ“ Better user experience (no data loss on refresh)
  âœ“ Audit trail for compliance

NEGATIF:
  - Setiap jawab = 1 extra POST request
  - Sedikit tambah DB size (untuk draft records)
  - Query monitor jadi lebih kompleks

MITIGASI:
  â†’ Auto-save adalah async (tidak block UI)
  â†’ Indexes sudah optimize query
  â†’ Cleanup strategy available (optional)

================================================================

END OF QUICK REFERENCE
